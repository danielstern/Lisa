<!doctype HTML>
<!-- Copyright 2013 danielstern.ca - feel free to examine, learn and apply -->

<html ng-app=''> 
<head>
  <title>Legend Game</title>
  <meta name="viewport" content="width=device-width; initial-scale=1.0;">
  
  <script type="text/javascript" src="//use.typekit.net/lhm5okc.js"></script>
  <script src="lib/jquery/jquery-1.10.1.min.js"></script> 
  <script src="lib/angular/angular.js"></script>
  <script src="lib/less/less-1.3.3.min.js"></script>
  <script src="lib/bootstrap/js/bootstrap.js"></script>
  <script src="lib/underscore/underscore.js"></script>

  <link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap-responsive.css">
    <!-- 
  -->
</head>
<div class='container' style='padding:60px;'>
  <div class="row">
    <div class='span3'>
      <h3>Lisa</h3>
      <p id='dialogue'>Hey baby.</p>
      <form id='conversation-form'>
        <input class='disabled' id='conversation-input' type='text'>
      </form>
      <button class='btn' id='saySomethingRandom'>Say Something Random</button>
    </div>
    <div class='span3'>
      <img src='../misc/lisa.jpg' width='200px' height='auto'>
    </div>
  </div>

</div>

<script>

  $('#conversation-form').submit(function(e){

    var $input = $('#conversation-input');
    var inputText = $input.val();
    $input.val('');

    $Lisa.isTalkingTo($responder);
    $Lisa.hears(inputText);

    function $responder(words) {
      $('#dialogue').html(words); 
    }

    e.preventDefault();
    return false;
  })

  $('#saySomethingRandom').click(function(){

       $('#dialogue').html($Lisa.saySomethingRandom()); 


  });

  var Lexicon = {
    things:[
    {
      word:'apple',
      is:['delicious','healthy','crunchy'],
      extends:['fruit'],
      plural:'apples',
      associated:['pear','fruit'],
    },
    {
      word:'apple',
      is:['delicious','healthy','crunchy'],
      extends:['fruit'],
      plural:'apples',
      associated:['pear','fruit'],
    },
    {
      word:'puppy',
      is:['cute','adorable'],
      extends:['dog'],
      plural:'puppies',
      associated:['kitten'],
    },
    {
      word:'potato',
      is:['healthy','starchy'],
      extends:['vegetable'],
      plural:'potatoes',
      associated:[],
    },
    {
      word:'candy',
      is:['delicious','unhealthy'],
      associated:[
        {
          word:'teeth',
          how:['cavity']
        }
      ]
    },
    {
      word:'fork',
      plural:'forks',
      is:['pointy'],
      extends:['tool']
    }
   ],
  attributes:[ 
    {
      word:'delicious',
      associated:['tasty','yummy','scrumptious'],
    }
    ],
   expressions:[{
     for:'tasty',
     said:'hits the spot.'
   }

   ]
  };


  function Lisa() {

    var Lisa = this;
    var inTheConversation = [];

    Lisa.name = 'Lisa';

    Lisa.thinks = function(thought) {

      console.log('LISA:' , thought);
    }

    Lisa.hears = function(words) {

      var reply = Lisa.brain.process(words);
      Lisa.says(reply);


    }

    Lisa.isTalkingTo = function(thing) {

      inTheConversation.push(thing);

    }

    Lisa.saySomethingRandom = function() {

      return Lisa.brain.ponder();

    }

    Lisa.says = function(words) {

      _.each(inTheConversation, function(_responder){_responder(words)})
      return words;

    }

    Lisa.brain = new Brain(Lisa);
  }

  function Brain(host) {

    var brain = this;
    this.host = host;
    this.lexicon = localStorage.getItem('lexicon') || Lexicon;
    this.host.thinks('I have a lexicon!');
    this.host.thinks(this.lexicon);

    brain.process = function(words) {

      this.host.thinks('Hmm, someone said ' + words + '.');
      var $analysis = this.analyze(words);
      this.host.thinks($analysis);
      return 'Sorry, but I have no idea what that, or anything else, means right now.';

    }

    brain.analyze = function(words) {

      var analysis = {};
      var singleWords = words.split(' ');
      analysis['wordCount'] = singleWords.length;
      analysis['isQuestion'] = words.indexOf('?') != -1;
      analysis['refersToHost'] = words.indexOf(this.host.name) != -1;
      analysis['wordsRecognized'] = _.map(singleWords, function(word) { 

       // To do... are there any words in Lisa's lexicon that she can use to respond?
       })
      return analysis;

    }

    brain.ponder = function(ideas) {

      var seed = _.sample(this.lexicon.things);
      var response = '';
      response += " " + (seed.plural || seed.word) + " " + (seed.plural ? 'are' : 'is') + " " + _.sample(seed.is);
      response = brain.prettify(response);
      return response;

    }

    brain.prettify = function(phrase) {
      phrase += ('.');
      phrase = _.capitalize(phrase);
      return phrase;
    }

  }

  var $Lisa = new Lisa();

  _.mixin({
     capitalize: function(string) {
      return string.charAt(1).toUpperCase() + string.substring(2).toLowerCase();
   //return 'blah';
  }
});



</script>
